# מסמך איפיון - מערכת הצגת שעות זמינות למרפאות

## סקירה כללית

**שם הפרויקט:** Clinic Queue Management  
**גרסה:** 1.0.0  
**סוג:** WordPress Plugin  
**תיאור:** מערכת הצגת שעות זמינות למרפאות עם אינטגרציה ל-Elementor ו-Shortcode

## מטרות הפרויקט

1. **הצגת שעות זמינות** - מערכת להצגת שעות זמינות למרפאות רפואיות
2. **אינטגרציה עם WordPress** - פלאגין מלא עם ממשק ניהול
3. **תמיכה ב-Elementor** - ווידג'ט גרירה ושחרור
4. **תמיכה ב-Shortcode** - שימוש בכל מקום ב-WordPress
5. **ממשק ניהול בסיסי** - דשבורד לניהול כללי
6. **תמיכה ב-RTL** - תמיכה מלאה בעברית וערבית
7. **אינטגרציה ישירה עם API** - קבלת תורים בזמן אמת ללא שמירה מקומית

## ארכיטקטורה כללית

### מבנה הקבצים

```
clinic-queue-management/
├── clinic-queue-management.php          # נקודת כניסה ראשית
├── README.md                           # תיעוד בסיסי
├── SPECIFICATION.md                    # מסמך איפיון זה
│
├── core/                               # ליבת המערכת
│   ├── class-plugin-core.php          # מנהל מרכזי
│   └── class-helpers.php              # פונקציות עזר
│
├── api/                                # ממשקי API
│   ├── class-api-manager.php          # מנהל API חיצוני
│   └── class-rest-handlers.php        # מנהל REST API
│
├── admin/                              # ממשק ניהול
│   ├── class-dashboard.php            # דשבורד ראשי
│   ├── class-admin-menu.php           # מנהל תפריט ניהול
│   ├── class-ajax-handlers.php        # מנהל AJAX
│   ├── assets/                        # נכסי ממשק ניהול
│   │   └── js/                        # JavaScript
│   └── views/                         # תבניות HTML
│
├── frontend/                           # ממשק משתמש
│   ├── widgets/                       # ווידג'טים
│   │   ├── class-clinic-queue-widget.php      # ווידג'ט Elementor
│   │   └── managers/                  # מנהלי ווידג'ט
│   │       ├── class-widget-ajax-handlers.php  # מנהל AJAX
│   │       ├── class-calendar-data-provider.php # ספק נתונים
│   │       └── class-calendar-filter-engine.php # מנוע סינון
│   ├── shortcodes/                    # Shortcodes
│   │   └── class-shortcode-handler.php       # מנהל Shortcode
│   └── assets/                        # נכסי Frontend
│       ├── css/                       # עיצוב
│       └── js/                        # JavaScript
│
└── data/                               # נתונים
    └── mock-data.json                 # נתוני דמו (לפיתוח בלבד)
```

## רכיבי המערכת

### 1. ליבת המערכת (Core)

#### Clinic_Queue_Plugin_Core
- **תפקיד:** מנהל מרכזי של הפלאגין
- **אחריות:**
  - טעינת תלויות
  - רישום AJAX handlers
  - רישום REST API endpoints
  - הוספת תפריט ניהול
  - רישום ווידג'טים

#### Clinic_Queue_Helpers
- **תפקיד:** פונקציות עזר כלליות
- **פונקציות:**
  - ניקוי קלט משתמש
  - אימות נתונים
  - עיצוב תגובות

### 2. ממשק API

#### Clinic_Queue_API_Manager
- **תפקיד:** ניהול API חיצוני
- **פונקציות:**
  - קבלת תורים מ-API חיצוני בזמן אמת
  - קבלת שעות זמינות לפי מזהה יומן/רופא/מרפאה
  - אימות תגובת API
  - טיפול בשגיאות API

**הערה חשובה:** אין שמירה מקומית של נתונים ואין סנכרון. כל קריאה היא ישירה ל-API החיצוני.

### 3. ממשק ניהול (Admin)

#### Dashboard
- **תפקיד:** דשבורד ראשי
- **תכונות:**
  - מידע כללי על התוסף
  - הגדרות בסיסיות

### 4. ממשק משתמש (Frontend)

#### Elementor Widget
- **תפקיד:** ווידג'ט Elementor
- **תכונות:**
  - הגדרת מזהה יומן/רופא/מרפאה
  - הצגת שעות זמינות בזמן אמת
  - פנייה ישירה ל-API בכל טעינת עמוד
  - הצגת לוח שנה ושעות זמינות

#### Shortcode Handler
- **תפקיד:** מנהל Shortcode
- **תכונות:**
  - `[clinic_queue]` - הצגת מערכת שעות זמינות
  - פרמטרים: `doctor_id`, `clinic_id`

## מבנה נתונים

**הערה חשובה:** המערכת לא משתמשת יותר במסד נתונים מקומי לשמירת תורים. כל הנתונים מגיעים ישירות מה-API החיצוני.

### פורמט תגובת API

המערכת מצפה לקבל מ-API החיצוני תגובה בפורמט הבא:

```json
{
  "calendar_id": "string",
  "doctor_id": "string",
  "clinic_id": "string",
  "available_slots": [
    {
      "date": "YYYY-MM-DD",
      "time_slots": [
        {
          "time": "HH:MM",
          "available": true
        }
      ]
    }
  ]
}
```

## API Endpoints

### REST API (פנימי - WordPress)
- `GET /wp-json/clinic-queue/v1/appointments`
  - פרמטרים: `calendar_id` או `doctor_id` + `clinic_id`
  - החזרה: נתוני שעות זמינות מה-API החיצוני

### AJAX Endpoints
- `wp_ajax_clinic_queue_get_appointments` - קבלת שעות זמינות
  - פרמטרים: `calendar_id` או `doctor_id` + `clinic_id`
  - פעולה: פנייה ישירה ל-API החיצוני והחזרת תוצאות

### External API (חיצוני)
- המערכת פונה ל-API חיצוני עם מזהה יומן/רופא/מרפאה
- כל קריאה היא בזמן אמת - אין שמירה מקומית
- אין Cache - כל נתונים מגיעים ישירות מה-API

## תכונות מתקדמות

### 1. אינטגרציה ישירה עם API
- פנייה ישירה ל-API בכל טעינת ווידג'ט
- אין שמירה מקומית של נתונים
- נתונים תמיד מעודכנים בזמן אמת

### 2. ביצועים
- טעינה איטית של נכסים
- ניהול זיכרון יעיל
- אופטימיזציה למספר ווידג'טים

### 3. תמיכה ב-RTL
- עיצוב מותאם לעברית
- תמיכה מלאה בכיוון ימין-שמאל
- פונטים עבריים

### 4. ביצועים
- טעינה איטית של נכסים
- ניהול זיכרון יעיל
- אופטימיזציה למספר ווידג'טים

## דרישות מערכת

### דרישות מינימליות
- WordPress 5.0+
- PHP 7.4+
- MySQL 5.6+

### דרישות מומלצות
- WordPress 6.0+
- PHP 8.0+
- MySQL 8.0+
- Elementor 3.0+ (אופציונלי)

## אבטחה

### הגנות
- בדיקת `ABSPATH` בכל קובץ
- Sanitization של קלט משתמש
- Nonce verification ל-AJAX
- בדיקת הרשאות משתמש

### הרשאות
- `manage_options` לפעולות ניהול
- גישה ציבורית ל-API endpoints
- בדיקת הרשאות לכל פעולה

## תחזוקה ופיתוח

### לוגים
- לוגים של סנכרון
- לוגים של שגיאות
- מעקב אחר ביצועים

### עדכונים
- מערכת גרסאות
- עדכון אוטומטי של טבלאות
- גיבוי נתונים

### בדיקות
- בדיקות יחידה
- בדיקות אינטגרציה
- בדיקות ביצועים

## תכונות עתידיות

### שלב 2
- אינטגרציה עם מערכות CRM
- התראות SMS/Email
- תשלומים אונליין

### שלב 3
- אפליקציה ניידת
- AI לניהול תורים
- אנליטיקס מתקדם

## מסקנות

המערכת מספקת פתרון מקיף להצגת שעות זמינות במרפאות עם:
- ארכיטקטורה מודולרית וגמישה
- ממשק משתמש אינטואיטיבי
- תמיכה מלאה בעברית
- אינטגרציה מלאה עם WordPress
- אפשרויות הרחבה עתידיות

המערכת מוכנה לשימוש בסביבת ייצור עם כל התכונות הנדרשות להצגת שעות זמינות מקצועית.
